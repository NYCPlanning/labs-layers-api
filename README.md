[![CircleCI](https://circleci.com/gh/NYCPlanning/labs-layers-api.svg?style=svg)](https://circleci.com/gh/NYCPlanning/labs-layers-api)

This is a web API for serving layer groups, which are a custom data model for named groups of Mapbox GL layers and their associate legend and source data.


## Requirements

You will need the following things properly installed on your computer.

- [Git](https://git-scm.com/)
- [Node.js](https://nodejs.org/) (with NPM)
- [Yarn](https://yarnpkg.com/en/)


## Local development

- Clone this repo: `git clone git@github.com:NYCPlanning/labs-layers-api.git`
- Navigate to the repo: `cd labs-layers-api`
- Install the dependencies: `yarn`
- Start the server: `NEW_RELIC_LICENSE_KEY=<your-key> yarn run devstart`

## Running without New Relic
For development purposes, you can run the API without providing a New Relic license key by disabling New Relic.
Comment out the New Relic import at the top of `app.js`:
```
// require('newrelic');
```

## Schemas

- [Layer Group](https://github.com/NYCPlanning/labs-layers-api/blob/develop/schemas/layer-group.js)
- [Layer](https://github.com/NYCPlanning/labs-layers-api/blob/develop/schemas/layer.js)
- [Source](https://github.com/NYCPlanning/labs-layers-api/blob/develop/schemas/source.js)

## Testing and checks

- **ESLint** - We use ESLint with Airbnb's rules for JavaScript projects
  - Add an ESLint plugin to your text editor to highlight broken rules while you code
  - You can also run `eslint` at the command line with the `--fix` flag to automatically fix some errors.

- **Testing**
  - run `yarn test`


## Sprites

The sprite sheet is generated by scripts that create a set of SVGs, then turn them into four files served in `public/static/`:
- `sprite.json`
- `sprite.png`
- `sprite@2x.json`
- `sprite@2x.png`

SVG files are output to `assets/sprite/svg/` by `assets/sprite/create-sprite-svgs.js`. Edit this file to change the automatically-created SVGs.
- Run `npm run create-sprite-svgs` to create the SVGs

The `.png` and `.json` files for Mapbox GL to consume are created with  [spritezero-cli](https://github.com/mapbox/spritezero-cli).
- If you haven't, install the command-line interface: `npm install -g @mapbox/spritezero-cli`
- Run the commands to generate the sprites at each resolution:
  - `spritezero public/static/sprite assets/sprite/svg/`
  - `spritezero public/static/sprite@2x assets/sprite/svg/ --ratio=2`
